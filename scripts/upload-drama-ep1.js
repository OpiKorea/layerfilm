const { createClient } = require('@supabase/supabase-js');
const { Upload } = require('tus-js-client');
const path = require('path');
const fs = require('fs');

// Load env vars
require('dotenv').config({ path: path.resolve(__dirname, '../.env.local') });

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY; // TUS needs anon key usually or specific token

if (!supabaseUrl || !supabaseServiceKey) {
    console.error('Missing Supabase credentials in .env.local');
    process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseServiceKey);

const VIDEO_PATH = path.resolve(__dirname, '../public/drama-ep1-compressed.mp4');
const BUCKET_NAME = 'videos';
const FILE_NAME = `drama-ep1-${Date.now()}.mp4`;

// The script provided by the user
const FULL_SCRIPT = `1í™” ì¸ì‚¬ (ìƒëµ - ìœ„ì™€ ë™ì¼í•˜ì§€ë§Œ ë„ˆë¬´ ê¸¸ì–´ì„œ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì—ì„œëŠ” ë³€ìˆ˜ë¡œ ì²˜ë¦¬ë¨)`;
// Note: In real execution, I will use the full text variable defined below again to ensure it's captured.

const FULL_SCRIPT_TEXT = `1í™” ì¸ì‚¬
íšŒìƒ‰ë¹› ë°”ë‹¥ì´ ì –ì–´ìˆëŠ” ê²ƒì„ ë³´ë‹ˆ ìƒˆë²½ì— ë¹„ê°€ ì™”ì—ˆë‚˜ ë³´ë‹¤.
ì•„ì¹¨ë¶€í„° íë¦¿í•œ ì–¸ëœ» ë³´ë©´ íšŒìƒ‰ ë„ì‹œì™€ í•˜ëŠ˜ì´ ì´ì–´ì ¸ ë³´ì´ê¸°ë„ í•˜ë‹¤.
ê³¨ëª©ê¸¸ ì–´ê·€ì—ì„œ í•œ í˜•ì²´ê°€ ì¡°ì‹¬ìŠ¤ë ˆ ëª¸ì„ í˜ë“¤ê²Œ ì¼ìœ¼í‚¤ê³  ìˆë‹¤
ë§ˆì¹˜ ê°“ íƒœì–´ë‚œ ë§ì•„ì§€ì²˜ëŸ¼ ì´ë¦¬ì €ë¦¬ ëª¸ì„ ë¹„í‹€ë©° í˜ë“¤ê²Œ ëª¸ì„ ì¼ìœ¼í‚¨ë‹¤.
ê·¸ í˜•ì²´ëŠ” ì‚¬ëŒì¸ ê²ƒ ê°™ì´ ë³´ì¸ë‹¤.
ê·¸ í˜•ì²´ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ ê³¨ëª©ê¸¸ ê·¼ì²˜ì— ìˆëŠ” ì“°ë ˆê¸°í†µì„ ë’¤ì ì´ë©° ìŒì‹ë¬¼ì„ ì°¾ì•˜ê³ 
ë¬´ì—‡ì¸ê°€ ë°œê²¬í•œ ë“¯ í•¥ì•„ ë¨¹ê¸° ì‹œì‘í•œë‹¤.
ë¬´ìŠ¨ ë§›ì´ë¼ë„ ë‚˜ëŠ” ê±¸ê¹Œ? ë¹—ë¬¼ì— ë‹¤ ì –ì€ ì¢…ì´ ìª¼ê°€ë¦¬ì— ë¬»ì€ ì–‘ë…ë¿ì¸ë°ë„ ê·¸ í˜•ì²´ëŠ” ì‚´ê³  ì‹¶ë‹¤ë©° ì‚´ì•„ì•¼ í•œë‹¤ê³  ëª¸ìœ¼ë¡œ í‘œí˜„í•˜ë“¯ ê±°ì¹¨ì—†ì´ í•¥ê³  ìˆë‹¤. 
ë‹¨ì§€ ì‚´ì•„ìˆì„ ë§Œí¼ì˜ ì›€ì§ì¼ ë§Œí¼ì˜ ì˜ì–‘ì†Œë§Œì„ ì›í•˜ëŠ” ê²ƒ ê°™ë‹¤.
í•œì°¸ì„ ë’¤ì ì´ë˜ ê·¸ í˜•ì²´ëŠ” ë” ì´ìƒì˜ ì˜ì–‘ì†ŒëŠ” ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ë“¯ì´ ì£¼ë³€ì„ ì‚´í”¼ê³ ëŠ” ë¹„í‹€ê±°ë¦¬ë©° ê¸¸ê±°ë¦¬ì— ë‚˜ì„œê¸° ì‹œì‘í•œë‹¤. 
ì •ì¥ì„ ë§ë”íˆ ì°¨ë ¤ì…ì€ ì„±ì¸ ë‚¨ì„±ë“¤, í•™êµì— ê°€ëŠ”ë“¯í•œ ì–´ë¦° ì†Œë…€ë“¤, í•œ ì†ì—” ì§€íŒ¡ì´ë¥¼ ë”›ê³  ì–´ë”˜ê°€ ë¶€ì§€ëŸ°íˆ ê±¸ì–´ê°€ëŠ” í• ë¨¸ë‹ˆ.
ê·¸ë“¤ ì‚¬ì´ ì–´ìš¸ë¦¬ì§€ ì•Šì€ ëª¨ìŠµì„ í•œ í˜•ì²´ê°€ ì„œ ìˆë‹¤.
ë‹¤ ì°¢ì–´ì§„ ë°”ì§€ë„ë¦¬ì— ì¼ë¶€ë¡œ ê°ì¶˜ë“¯í•œ ì•„ë‹ˆ, ë³´í˜¸í•˜ë ¤ëŠ”ì§€ë„ ëª¨ë¥¼ ë‘êº¼ìš´ ì†œ ì í¼ì— ëˆˆ ë°‘ê¹Œì§€ ë‚´ë ¤ì˜¨ ëª¨ì. 
ì–¸ì œ ê°ì•˜ëŠ”ì§€ë„ ëª¨ë¥´ëŠ” ë¨¸ë¦¬ì¹´ë½ë“¤ì´ ì–¼êµ´ì´ ê°™ì´ ì–¼êµ´ì„ ê°€ë¦¬ê³  ìˆë‹¤.
ê°‘ì‘ìŠ¤ë ˆ ë‘êº¼ìš´ ì†œ ì í¼ì˜ ì§€í¼ë¥¼ ë‚´ë¦¬ê³  ê·¸ ì•ˆì— ì…ê³  ìˆë˜ ì˜·ë“¤ë„ í•œì°¸ì„ ë’¤ì ì´ë”ë‹ˆ ë¬´ì—‡ì¸ê°€ë¥¼ êº¼ë‚¸ë‹¤.
ê·¸ í˜•ì²´ì— ë¬´ì—‡ë³´ë‹¤ ì¤‘ìš”í•œ ì•„ë‹ˆ ë¬´ì—‡ë³´ë‹¤ ì†Œì¤‘í•œ ë¬¼ê±´ì¸ ê²ƒ ê°™ë‹¤.
ê·¸ ë¬¼ê±´ì„ ë“¤ê³  ì‚¬ëŒë“¤ì—ê²Œ í•œ ê±¸ìŒ í•œ ê±¸ìŒ ë‹¤ê°€ê°„ë‹¤.
ì´ë¹¨ì€ ì–´ê¸ˆë‹ˆë§Œ ë‚¨ì•„ìˆê³  ì–¸ì œ í˜€ë¥¼ ë‹¦ì•˜ëŠ”ì§€ ì¹¨ì´ ì—‰ê²¨ë¶™ì€ ìƒíƒœë¡œ ì…ì„ ë²Œë¦¬ë©° ì‚¬ëŒë“¤ì—ê²Œ ë¬»ê¸° ì‹œì‘í•œë‹¤.
ï¼‚í˜¹ì‹œ ì´ ì—¬ìë¥¼ ì•„ì‹œë‚˜ìš”?ï¼‚
ë¬´ì—‡ì¸ì§€ ì§ì‘ë„ ë˜ì§€ ì•Šê³ , ë¬¼ì— ì –ì–´ë²„ë ¤ ë­”ì§€ ëª¨ë¥¼ ,ë¬´ì—‡ì´ì—ˆëŠ”ì§€ ì¶”ì¸¡í•´ ë³´ì§€ë„ ëª»í•  ë¬¼ê±´ì„ í˜ë“¤ê²Œ ì—‰ê±°ì£¼ì¶¤í•œ ìì„¸ë¡œ ë“¤ì³ì§€ê³ ì„œëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë¬»ê³  ìˆë‹¤.
ì˜ˆì¸¡ê±´ëŒ€ ëˆ„êµ¬ë„ ë¬´ì—‡ì¸ì§€ ëª¨ë¥¼ ê²ƒì´ ë¶„ëª…í•˜ë‹¤.
ì‚¬ëŒë“¤ì€ ë‹¹ì—°í•˜ë“¯ ë©€ë¦¬ ë–¨ì–´ì ¸ ê±·ê¸° ì‹œì‘í•˜ê³  íœ´ëŒ€ì „í™”ê¸°ì— ì•ì„ ë³´ì§€ ì•Šë˜ ì‚¬ëŒë“¤ì€ í—ë ˆë²Œë–¡ ì˜†ìœ¼ë¡¤ ë¹„ì¼œ ë¹ ë¥¸ ê±¸ì„ í•œë‹¤. ë©€ë¦¬ì„œë¶€í„° ê´‘ê²½ì„ ì§€ì¼œë³¸ ì‚¬ëŒë“¤ì€ ê²½ê³„í•˜ëŠ” ëˆˆë¹›ìœ¼ë¡œ ì§€ë‚˜ì¹œë‹¤.
í•œì°¸ì„ ì‚¬ëŒë“¤ì—ê²Œ ë¬»ë˜ ê·¸ í˜•ì²´. ìì‹  ê·¼ë°©ìœ¼ë¡œ ë‹¤ê°€ì˜¤ëŠ” êµ°ì¸ì—ê²Œ ëˆˆì´ ê°„ë‹¤.
ì´ í˜•ì²´ëŠ” ê·¸ ë¬¼ê±´ì„ ë“¤ì´ë°€ë©° ï¼‚ì´ ì—¬ìë¥¼ ì•„ì‹œë‚˜ìš”?ï¼‚ë¼ë©° ì§ˆë¬¸ì„ í•˜ê¸° ì‹œì‘í•œë‹¤.
êµ°ì¸ì€ ì˜ ëª¨ë¥´ê² ë‹¤ê³  ë§í•˜ë©° ê·¸ í˜•ì²´ì™€ ëˆˆì´ ë§ˆì£¼ì¹˜ê³  ìˆœê°„ ëª¸ì´ êµ³ëŠ”ë‹¤.
ì†Œë¦„ ë¼ì¹˜ë„ë¡ ê´´ì´í•˜ê²Œ ìƒê²¼ìœ¼ë©° ì–¼êµ´ì—ëŠ” í™”ìƒì¸ì§€ ì–´ë–¤ ìˆ˜ìˆ ì˜ í›„ìœ ì¦ì¸ì§€ ëª¨ë¥´ê²Œ êµ‰ì¥íˆ í‰ì¸¡í•˜ê²Œ ì˜¤ë¥¸ìª½ì€ ëˆˆë¶€í„° í„±ê¹Œì§€ ì”¹ë‹¤ ë²„ë¦° ê»Œì²˜ëŸ¼ ë‚´ë¦¬ ì•‰ì•˜ê³ , ì†ì€ ì°°í™ì²˜ëŸ¼ ë•ì§€ë•ì§€ ë¶™ì—¬ ë†“ì€ ê²ƒ ê°™ì•˜ë‹¤.
êµ°ì¸ì€ ëŒ€ê¾¸ ì—†ì´ ë¹ ë¥¸ ë°œê±¸ìŒìœ¼ë¡œ ìë¦¬ë¥¼ ë– ë‚œë‹¤.
ì´ë•Œ ë’¤ì—ì„œ ì–´ë–¤ ì†ì´ ì‚¬ì§„ì´ë¼ ì§ì‘ë˜ëŠ” ë¬¼ì²´ë¥¼ ë‚šì•„ì±ˆë‹¤.
ë†€ë€ ë“¯ ì¼ë°˜ì¸ë³´ë‹¤ ë¹ ë¥´ë‹¤ë©´ ë¹ ë¥¼ ì •ë„ë¡œ ê¸‰íˆ ëª¸ì„ ëŒë ¤ ë’¤ëŒì•„ ë³´ëŠ” í˜•ì²´.
ì´ë•Œ ë’¤ì—ì„  ì—¬ìê°€ ë§ì„ ê±´ë‹¤.
â€œì´ ì‚¬ëŒ ì œê°€ ì°¾ì•„ì¤„ê¹Œìš”?â€
í˜•ì²´ëŠ” ë‹¹í™©ìŠ¤ëŸ¬ìš´ì§€ ì•„ë¬´ ë§ ì—†ì´ ê·¸ ì—¬ìë¥¼ ìœ„ì•„ë˜ë¡œ í˜ê²¨ ë³¸ ë’¤ ë§ë³´ë‹¤ëŠ” ê³ ê°œë¥¼ ë„ë•ì¸ë‹¤.
â€œìš°ì„  ì‚¬ëŒë“¤ì´ ë§ìœ¼ë‹ˆ, ì¡°ìš©í•œ ê³³ì—ì„œ ëŒ€í™”í•´ìš”â€
ìš°ì„  ìì‹ ì„ ë”°ë¼ì˜¤ë¼ëŠ” ì—¬ì ê·¸ë¦¬ê³  ì•„ë¬´ ë§ ì—†ì´ ê·¸ ì—¬ìë¥¼ ë”°ë¼ê°€ëŠ” í˜•ì²´
ê·¸ë“¤ì´ ë„ì°©í•œ ê³³ì€ ë©€ì§€ ì•Šì€ í•œ ëª¨í…”ì´ì—ˆë‹¤.
ëª¨í…”ì— ë„ì°©í•˜ê³  ë§ì´í•´ì•¼ í•  ì£¼ì¸ì€ ë³´ì´ì§€ ì•Šì•˜ê³ ,
ìì—°ìŠ¤ëŸ½ê²Œ ì—˜ë¦¬ë² ì´í„°ë¥¼ íƒ€ê³  4ì¸µìœ¼ë¡œ í–¥í•œë‹¤.
ì˜ì‹¬ìŠ¤ëŸ½ì§€ë§Œ ë„ì™€ì¤€ë‹¤ëŠ” ë§ì— ì˜¨ í˜•ì²´ëŠ” ì•„ë¬´ ë§ ì—†ì´ ë¬µë¬µíˆ ë”°ë¼ë§Œ ê°€ê³  ìˆì—ˆë‹¤.
4ì¸µì— ë„ì°©í•˜ê³  ì–´ëŠ ë¬¸ì„ ë‘ë“¤ê¸°ì ëˆ„êµ°ê°€ ì•ˆì—ì„œ ë¬¸ì„ ì—´ì–´ì¤€ë‹¤.
í˜•ì²´ì™€ ì—¬ìëŠ” ê°™ì´ ë°©ì— ë“¤ì–´ê°€ê³ 
ë„ì°©í•œ ëª¨í…”ë°©ì—ëŠ” ì„±ì¸ ë‚¨ì„± ë‘ ëª…ì´ ì •ì¥ì°¨ë¦¼ê³¼ ì„ ê¸€ë¼ìŠ¤ë¥¼ ë¼ê³  ë°©ì•ˆì„ ì§€í‚¤ê³  ìˆì—ˆë‹¤.
ë„ì™€ì£¼ê² ë‹¤ëŠ” ì—¬ìëŠ” ìì—°ìŠ¤ë ˆ í…Œì´ë¸” ì˜ìì— ì•‰ìœ¼ë©° ë§ì„ í•œë‹¤.
â€œìš°ì„  ì”»ê³  ì´ì•¼ê¸°í•˜ì‹œì£ . ë“œì‹¤ ê²ƒë„ ë§ˆë ¨í•´ ë‘˜ê²Œìš”.â€
í˜•ì²´ëŠ” ê²½ê³„í•˜ë“¯ ë‚¨ìë“¤ì„ ì³ë‹¤ë³´ê³  ìˆì—ˆê³  ì—¬ìëŠ” ëˆˆì§“ìœ¼ë¡œ ë‚¨ìë“¤ì„ ë°–ìœ¼ë¡œ ë‚´ë³´ë‚¸ë‹¤.
â€œì´ë¶„ ì…ì„ ì˜·ì´ë‘ ë¨¹ì„ ê²ƒ ì¢€ ì‚¬ì™€â€ 
ë§ì—†ì´ ê³ ê°œë§Œ ë„ë•ì´ê³ ëŠ” ë‚˜ê°€ëŠ” ì„±ì¸ ë‚¨ìë“¤.
í˜•ì²´ëŠ” ì´ì œì•¼ ì•½ê°„ì˜ ê²½ê³„ë¥¼ í’€ê³  ìƒ¤ì›Œì‹¤ ì•ì—ì„œ ì˜·ì„ ë²—ê³ ëŠ” ìƒ¤ì›Œë¥¼ ì‹œì‘í•œë‹¤.
í˜•ì²´ëŠ” ë“£ì§€ ëª»í–ˆì§€ë§Œ, ìƒ¤ì›Œì‹¤ ë°–ì—ì„œ ì—¬ì ê°€ëŠ” ëˆ„êµ°ê°€ì™€ í†µí™”ë¥¼ í•œë‹¤.
â€œë„¤ ì°¾ì•˜ì–´ìš” ì „í™”ë“œë¦´ê²Œìš”.â€
ìƒ¤ì›Œí•˜ëŠ” ê·¸ í˜•ì²´ëŠ” ìƒ¤ì›Œë¥¼ í•œ ì§€ ì˜¤ë˜ë¼ì„œ ë‚¯ì„  ê²ƒì¸ì§€ ì•„ë‹ˆë©´ í•˜ëŠ” ë°©ë²•ì„ ìŠì—ˆëŠ”ì§€ ìƒ¤ì›Œê¸° ê¼­ì§€ì—ì„œ íë¥´ëŠ” ë¬¼ë§Œ ë§ê³  ìˆë‹¤.
ì”»ëŠ”ë‹¤ëŠ” í‘œí˜„ë³´ë‹¤ í”¼ë¶€ë¥¼ ë¬¼ì— ë¶€ë”ªíˆê³  ìˆì—ˆë‹¤. ê·¸ë¦¬ë”ë‹ˆ ìì‹ ì˜ ëª¸ê³¼ ì–¼êµ´ì„ ê±°ìš¸ì„ í†µí•´ í•œì°¸ì´ë‚˜ ì³ë‹¤ë³´ê³  ì–‘ë…ë¿ì¸ë°ë„.
í•œìª½ ì–¼êµ´ì€ ë‚´ë¦¬ ì•‰ì•˜ê³  ë“±ë¶€í„° ê°€ìŠ´ ë°°, íŒ”ê¹Œì§€ ì˜¤ë˜ì „ì— í™”ìƒì„ ì…ì€ ë“¯ ì§“ì´ê²¨ì ¸ ìˆì—ˆë‹¤.
ì–¼êµ´ì´ ë¶‰ì–´ì§€ê³  ëˆˆì•Œì€ ë‹¹ì¥ì—ë¼ë„ ë¹ ì§ˆ ë“¯ ë¶‰ê²Œ ë¬¼ë“¤ì—ˆë‹¤. 
í•œì°¸ì´ ì§€ë‚˜ì„œ ìƒ¤ì›Œì‹¤ì„ ë‚˜ì˜¨ ê·¸ í˜•ì²´ ë‹¹ì—°í•˜ë‹¤ëŠ” ë“¯ ë‹¦ì§€ë„ ì•Šì€ ì –ì€ ëª¸ìœ¼ë¡œ ì˜·ì„ ë‹¤ì‹œ ì…ê¸° ì‹œì‘í–ˆê³ ,
ì—¬ìê°€ ì•‰ì€ í…Œì´ë¸” ë§ì€í¸ì— ì•‰ëŠ”ë‹¤.
â€œì´ ì—¬ìë¥¼ ì•„ì‹œë‚˜ìš”?â€
ê·¸ë…€ëŠ” ì´ë§ë°–ì— ëª»í•œë‹¤ëŠ” ë“¯ì´ ë˜í•œ ë²ˆ ë¬»ê³  ìì‹ ì„ ë°ë ¤ì˜¨ ì—¬ìì™€ ëŒ€í™”ë¥¼ ì‹œë„í•œë‹¤.?â€œìš°ì„  ì„±í•¨ë¶€í„° ì•Œë ¤ì£¼ì„¸ìš”. ì €ëŠ” ì§€ì—°ì´ë¼ê³  í•´ìš”â€
ìì‹ ì˜ ì´ë¦„ì¡°ì°¨ ìŠê³  ì‚´ì•˜ëŠ”ì§€ í•œì°¸ì„ ëœ¸ì„ ë“¤ì´ë‹¤ê°€ ë§ì„ í•˜ê¸° ì‹œì‘í•œë‹¤.
â€œì €ëŠ” ì„±ìš°ì˜ˆìš” ì´ ì—¬ìë¥¼ ì•Œê³  ê³„ì‹œë‚˜ìš”?â€
ì¢…ì´ìª¼ê°€ë¦¬ë¥¼ ë‚´ë¯¸ëŠ” ì„±ìš°ëŠ” ê¼­ ì°¾ê³  ì‹¶ë‹¤ëŠ” ë“¯ ê°„ì ˆí•œ ëˆˆë¹›ìœ¼ë¡œ ì§€ì—° ì´ë¥¼ ì³ë‹¤ë³´ê¸° ì‹œì‘í•œë‹¤.
â€œì €ëŠ” ì´ ì—¬ìë¥¼ ì˜ ëª¨ë¥´ì§€ë§Œ ë‹¹ì‹ ì´ ì„¤ëª…í•´ì£¼ë©´ ì´ ì—¬ìë¥¼ ì°¾ì„ ìˆ˜ ìˆê²Œ ë„ì™€ì¤„ ìˆ˜ ìˆì–´ìš”â€ 
â€œì´ ì—¬ìì— ëŒ€í•´ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?â€
ëª» ë¯¿ê² ë‹¤ëŠ” ë“¯ì´ ëˆˆë¹›ìœ¼ë¡œ ë§ì„ í•˜ëŠ”, í•œí¸ì—ëŠ” ì •ë§ ì°¾ì•„ì¤„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì¼ê¹Œ ë¼ëŠ” ë³µì¡ ë¯¸ë¬˜í•œ ê°ì •ìœ¼ë¡œ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•œë‹¤.
ì„±ìš°ëŠ” ê·¸ë‚ ì„ íšŒìƒí•˜ë©° ì…ì„ ì—´ê¸° ì‹œì‘í–ˆë‹¤.
â€œ5ë…„ ì „ ë‚˜ì´ 40ì— ëŠ¦ê²Œ ê°–ê²Œ ëœ ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì•„ì´ì™€ ë‹¤ì‹œê¸ˆ ì‹ í˜¼ë¶€ë¶€ê°™ì´ ì•„ë‹ˆ ì‹ í˜¼ë¶€ë¶€ë³´ë‹¤ ë” ì‹ í˜¼ë¶€ë¶€ ê°™ì•˜ë˜ ë‚´ ë‚¨í¸ê³¼ ë‚¨ë¶€ëŸ¬ìš¸ ê²ƒ ì—†ë˜ ê°€ì •ì„ ê¾¸ë¦¬ê³  ìˆì—ˆì–´ìš”â€

â€œì—„ë§ˆ ë‚˜ ì˜¤ëŠ˜ í•™êµ ìˆ™ì œ ë‹¤í•˜ë©´ ì—„ë§ˆê°€ ì•„ì´ìŠ¤í¬ë¦¼ ë¨¹ê²Œ í•´ì¤€ë‹¤ê³  í–ˆì§€?â€
â€œë‹¹ì—°í•˜ì§€ ë‚´ ë”¸ ì—„ë§ˆê°€ ì‹œì¥ê°€ë©´ì„œ ì•„ì´ìŠ¤í¬ë¦¼ ì‚¬ì˜¬ê²Œ. ê·¸ë ‡ë‹¤ê³  ëŒ€ì¶© í•˜ë©´ ì•ˆ ëœë‹¤?â€
â€œì‘! ë‹¹ì—°í•˜ì§€ ì—„ë§ˆ ê¸ˆë°©ì™€ ì‚¬ë‘í•´ !â€
â€œì—¬ë³´ ì˜¬ ë•Œ ë§¥ì£¼ë„ ì¢€ ë¶€íƒí•´ ì˜¤ëŠ˜ ì¶•êµ¬ ìˆìœ¼ë‹ˆê¹Œ ì˜¤ëœë§Œì— ê°™ì´ í•œì”í•˜ë©´ì„œ ì‘ì›í•˜ìê³ â€

â€œë‚¨í¸ì˜ ë§ì— ì•Œê² ë‹¤ë©° ì§‘ì„ ë‚˜ì„°ì–´ìš”. ì§‘ ì•ì„ ë‚˜ì„œì„œ ì¥ì„ ë³´ëŸ¬ í•œì°¸ì„ ê±·ë‹¤ê°€ ë¬´ì—‡ì¸ê°€ ë†“ê³  ì™€ì„œ, ë‹¤ì‹œ ì§‘ìœ¼ë¡œ í–¥í–ˆì£ .
ì§‘ì— ë‹¤ë‹¤ë¼ì„œ 2ì¸µ ë¬¸ì•ì— ì„œì ì €ëŠ” ì–´ë– í•œ í­ë°œë¡œ 1ì¸µìœ¼ë¡œ ë‚ ì•„ê°”ì–´ìš”. ê·¸ í›„ ê°€ì¡±ë“¤ì´ ê±±ì •ë¼ì„œ ë¬´ì‘ì • ì§‘ì— ë“¤ì–´ê°”ëŠ”ë° ì–´ë–¤ ì—¬ìê°€ ê¸‰í•˜ê²Œ ê³„ë‹¨ì—ì„œ ë­”ê°€ë¥¼ ë–¨ì–´íŠ¸ë¦¬ê³  ê¸‰í•˜ê²Œ ë„ë§ê°€ë”êµ°ìš”â€
ê·¸ë•Œì˜ ì¼ì´ ìƒê°ë‚¬ëŠ”ì§€ ëª¸ì„ ë¶€ë“¤ë¶€ë“¤ ë–¨ë©° ëª¸ì„ ì„œ ìˆë‹¤ ì„±ìš°ì˜€ë‹¤.
ë•Œë§ˆì¹¨ ë¬¸ì—ì„œ ë…¸í¬ì†Œë¦¬ê°€ ë‚˜ì ëª¸ì„ ì›€ì¸ ë¦¬ê³  ë¬¸ìœ¼ë¡œ í–¥í•˜ëŠ” ì§€ì—°. 
ìŒì‹ê³¼ ë¬¼ ê·¸ë¦¬ê³  ì˜·ì„ ê±´ë„¤ë°›ê³  ë‚¨ìë“¤ì—ê²Œ ì•„ì§ ë“¤ì–´ì˜¤ì§€ ë§ë¼ëŠ” ë‚˜ì§€ë§‰í•œ ë§ì„ í•˜ê³ ëŠ” ë‹¤ì‹œ í…Œì´ë¸”ë¡œ ëŒì•„ì˜¨ë‹¤. 
â€œê´œì°®ì•„ìš”. ì²œì²œíˆ ë§ì”€í•˜ì…”ë„ ë¼ìš” ì‹œê°„ì€ ë§ì•„ìš”â€
ë¬¼ê³¼ ê·¼ì²˜ì—ì„œ ê¸‰í•˜ê²Œ ì‚¬ì˜¨ ë“¯í•œ ì£½ì„ ì˜¬ë ¤ë‘ëŠ” ì§€ì—°ì´ì—ˆë‹¤.
â€œí­ë°œ ë•Œë¬¸ì— ë¶ˆì€ í¬ê²Œ ë‚˜ ìˆëŠ” ìƒíƒœì˜€ê³ , ì˜ì‹¬ë˜ëŠ” ì—¬ìë¥¼ ì¡ê¸°ë³´ë‹¤ ìš°ì„  ê°€ì¡±ì„ ì‚´ë ¤ì•¼ê² ë‹¤ëŠ” ìƒê°ì— ì§‘ìœ¼ë¡œ ë“¤ì–´ê°”ì–´ìš”.
ì •ì‹ ì„ ìƒì—ˆëŠ”ì§€ ì£½ì—ˆëŠ”ì§€ ëª¨ë¥¼ ë‚¨í¸ê³¼ ë”¸ì„ ë°ë¦¬ê³  ë‚˜ì˜¤ë ¤ í•˜ëŠ”ë°, 1ì¸µìœ¼ë¡œ ë–¨ì–´ì§„ ê²ƒ ë•Œë¬¸ì¸ì§€ ë‹¤ë¦¬ë„ íŒ”ì—ë„ í˜ì´ ë“¤ì–´ê°€ì§€ ì•Šì•˜ì£ .â€
ë¶€ë“¤ë¶€ë“¤ ë–¨ë©° ëŒ€í™”ë¥¼ í•˜ëŠ” ì„±ìš°ì—ê²Œ ë¬¼ì„ ê±´ë„¤ì£¼ëŠ” ì§€ì—°ì´ì—ˆë‹¤. 
â€œì‹¬í˜¸í¡í•˜ì‹œê³ , ë¬¼ ë§ˆì‹œê³  ì²œì²œíˆ ì´ì•¼ê¸°í•˜ì„¸ìš”. ì•„ì°¨ ì£½ë¶€í„° ë“œì‹œê³ ìš”. ì²œì²œíˆ ì´ì•¼ê¸°í•´ìš” ê¸ˆë°© ë„ì›€ ë“œë¦´ í…Œë‹ˆê¹Œìš”.â€
ì²œì²œíˆ ëŒ€í™”í•˜ë¼ëŠ” ê·¸ë¦¬ê³  ê¼­ ë„ì™€ì¤€ë‹¤ëŠ” ë§ì„ ë“¤ì€ ì„±ìš°ëŠ” ë§ˆìŒì´ ì¡°ê¸ˆì€ í¸í•´ì§„ ê²ƒ ê°™ì•˜ë‹¤. ê·¸ë¦¬ê³ ëŠ” ë§ì„ ì´ì–´ê°€ëŠ” ì„±ìš°
â€œê²°êµ­ ë‚¨í¸ê³¼ ì•„ì´ëŠ” ë°ë¦¬ê³  ë‚˜ì˜¤ì§€ ëª»í–ˆê³  ëˆ„êµ°ì§€ ëª¨ë¥¼ ì—¬ìê°€ í˜ë¦¬ê³  ê°„ ì¢…ì´ë¥¼ ê°€ì§€ê³  ë‚˜ì˜¨ ê±°ì—ìš”. ê·¸ë¦¬ê³ ëŠ” ì§€ê¸ˆê» ê·¸ë…€ë¥¼ ì°¾ì•„ë‹¤ë…”ì£ â€
â€œê·¸ë…€ê°€ ë‚´ê°€ ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ì„ ìƒê²Œ í–ˆê³  í–‰ë³µí•œ ë‚´ ì‚¶ì„ ë§ì³ë†¨ìœ¼ë‹ˆê¹Œìš”. ì ˆëŒ€ë¡œ ìš©ì„œ ëª» í•´â€
ëˆˆì•Œì´ ë¹¨ê°›ê²Œ ë‹¬ì•„ì˜¤ë¥´ë©° ë§ì„ í•˜ëŠ” ê·¸ë…€ë¥¼ ì³ë‹¤ë³´ê³  ìˆëŠ” ì§€ì—°ì€ í¥ë¶„ì„ ê°€ë¼ì•‰íˆê¸° ìœ„í•´ ë§ì„ ê±´ë‹¤.
â€œê·¸ ì¢…ì´ ì € ì¢€ ë³¼ ìˆ˜ê°€ ìˆì„ê¹Œìš”?â€
ê·¸ëŸ¬ì ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ê±´ë„¤ëŠ” ì„±ìš°ì™€ ê·¸ê±¸ ë°›ì•„ë³´ëŠ” ì§€ì—°. ì§€ì—° ì´ëŠ” ì¬ë¡œ ì¸í•œ ê²ƒì¸ì§€ ë¬¼ì— ì –ì–´ì„œì¸ì§€ ì¢…ì´ì— ë­ê°€ ì íŒ ê²ƒì¸ì§€ ì‚¬ì§„ì´ì—ˆë˜ ê²ƒì¸ì§€ ì•Œì§€ ëª»í–ˆë‹¤.
ë‹¹í™©í•œ ì±„ ë§ì„ í•  ìˆ˜ ì—†ë˜ ì§€ì—° ì´ëŠ” ë§ì„ ëŒë¦°ë‹¤.
â€œë„ˆë¬´ ì¶¥ì§€ ì•Šë‚˜ìš” ë”°ëœ»í•œ ì˜·ìœ¼ë¡œ ê°ˆì•„ì…ìœ¼ì„¸ìš”. ì˜·ì€ ì¤€ë¹„ë˜ì–´ìˆì–´ìš”â€
ìŒì‹ê³¼ ë¬¼ì„ ì œê³µí•˜ê³  ìì‹ ì˜ ì™¸ëª¨ë¥¼ í˜ì˜¤í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ ì•ŠëŠ” ì§€ì—°ì´ ëŒ€í™”í•˜ë‹ˆ ì¡°ê¸ˆì˜ ì•ˆì‹¬ê³¼ ë…¸ê³¤í•¨ì´ ì°¾ì•„ì˜¤ëŠ” ì„±ìš°ì˜€ë‹¤.
ì§€ì—°ì€ ì„±ìš°ì˜ ëˆˆë™ìì™€ ëª¸ì˜ í”ë“¤ë¦¼ì´ ì¦ì•„ë“  ê²ƒìœ¼ë¡œ ë³´ì•„ ì¡°ê¸ˆì€ ì•ˆì •ë˜ì—ˆë‹¤ê³  íŒë‹¨í•œë‹¤.
â€œì„±ìš°ë‹˜ ì˜¤ëŠ˜ì€ ì—¬ê¸°ì„œ í­ì£¼ ë¬´ì‹œê³  ë‚´ì¼ ì œê°€ í•œ ë²ˆ ë” ì™€ì„œ ë” ë¬¼ì–´ë³¼ê²Œìš”. í˜¼ì ì°¾ìœ¼ì‹œëŠ” ê²ƒë³´ë‹¤ ì œê°€ ì´ì•¼ê¸°ë¥¼ ë“£ê³  ì°¾ì„ ìˆ˜ ìˆê²Œ ë„ì™€ë“œë¦¬ëŠ” ê²Œ ë” ì¢‹ì„ ê±° ê°™ì•„ìš”â€
ì„±ìš°ëŠ” ë‹¤ì‹œê¸ˆ ë§ˆìŒì„ ë†“ìœ¼ë©° ì¢‹ì€ ì‚¬ëŒì´ë¼ê³  ìƒê°í•˜ê³  ì•Œê² ë‹¤ë©° ëŒ€ë‹µí–ˆë‹¤.
â€œì˜¤ëŠ˜ ì €ë… ë¨¹ì„ ê²ƒê³¼ ë§ˆì‹¤ ê²ƒì€ ê°–ì¶° ë‘˜ê²Œìš” ë°–ì— ë‚¨ìë¶„ë“¤ì´ ìˆìœ¼ë‹ˆ í•„ìš”í•œ ê²Œ ìˆìœ¼ì‹œë©´ ë…¸í¬í•˜ì„¸ìš” ê·¸ë¶„ë“¤ì´ ë„ì™€ë“œë¦´ ê±°ì—ìš”â€ 
ê³ ê°œë¥¼ ë„ë•ì´ëŠ” ì„±ìš°ì˜€ë‹¤.
â€œì•„ì°¨ ì˜·ë„ ê°ˆì•„ì…ìœ¼ì„¸ìš” ì‚¬ì´ì¦ˆê°€ ì•ˆ ë§ìœ¼ë©´ ë§ì”€í•˜ì‹œê³ ìš” ì£½ ì˜†ì— ì˜ì–‘ì œ ì˜¬ë ¤ë’€ìœ¼ë‹ˆ ê¼­ ë“œì‹œê³ ìš”â€ 
ì„±ìš°ì—ê²Œ ë‹¹ë¶€í•˜ê³  ê·¸ë ‡ê²Œ ì¼ì–´ë‚˜ë”ë‹ˆ ì§€ì—° ì´ëŠ” ëª¨í…”ë°© ë°–ìœ¼ë¡œ ë‚˜ê°„ë‹¤.
â€œë„¤..â€
ì˜·ê°€ì§€ì™€ ì•Œì•½ì´ ë“¤ì–´ìˆëŠ” ë´‰íˆ¬ë¥¼ ë³´ê³ ëŠ” ìê·¸ë§ˆí•œ ëª©ì†Œë¦¬ë¡œ ëŒ€ë‹µí•˜ëŠ” ì„±ìš°ì˜€ë‹¤.

ì§€ì—°ì€ ë°–ì„ ë‚˜ì„œì ëˆ„êµ°ì§€ ëª¨ë¥¼ ì‚¬ëŒì—ê²Œ ì „í™”í•œë‹¤.
â€œë„¤ ë§ì•„ìš”. ì¡°ë§Œê°„ ë°ë¦¬ê³  ê°ˆê²Œìš”. ê¸‰í•˜ê²Œ í•˜ë©´ ì˜¤íˆë ¤ íƒˆì´ ë‚˜ìš”. ë„¤ ì•Œê² ì–´ìš”â€
ê·¸ë ‡ê²Œ ì „í™”ë¥¼ ëŠê³ ëŠ” ê²€ì€ìƒ‰ ì™¸ì œ ì°¨ ë’·ì¢Œì„ì— íƒ€ëŠ” ì§€ì—°ì´ 
â€œì–´ë””ë¡œ ëª¨ì‹¤ê¹Œìš”â€ 
ìš´ì „ì‚¬ì˜ ë§ì— ì³ë‹¤ë³´ì§€ë„ ì•Šê³  ë¬´ì–¸ê°€ë¥¼ ë…¸íŠ¸ì— ì ê¸° ë°”ìœ ì§€ì—° ì´ëŠ” íšŒì‚¬ë¡œ ê°€ìê³  ëŒ€ë‹µì„ í•œë‹¤. 
í˜¼ìë‚¨ì€ ì„±ìš°ëŠ” í•œì°¸ì„ í…Œì´ë¸”ì— ì•‰ì•„ìˆë‹¤ê°€ ëˆˆì— ë“¤ì–´ì˜¨ ì˜·ê°€ì§€ë“¤ì„ ë°”ë¼ë³¸ë‹¤. 
ìë¦¬ì— ì¼ì–´ë‚˜ ì˜·ê°€ì§€ë“¤ì„ í¼ì³ë³´ë”ë‹ˆ í¥ì–¼ê±°ë¦¬ê¸° ì‹œì‘í•˜ë©° ì²œì²œíˆ ìƒˆë¡œìš´ ì˜·ë“¤ë¡œ ê°ˆì•„ì…ëŠ”ë‹¤.?ê·¸ë¦¬ê³ ëŠ” ê±°ìš¸ ì† ìì‹ ì„ ëš«ì–´ì§€ê²Œ ë°”ë¼ë³¸ë‹¤.
ì²œì²œíˆ ë¶‰ì–´ì§€ëŠ” ì–¼êµ´ ë˜ í•œ ë²ˆ ë¶ˆê²Œ í„°ì§ˆ ê²ƒ ê°™ì€ ëˆˆì•Œ. ê·¸ë¦¬ê³ ëŠ” ì§€ë‚œ ê³¼ê±°ê°€ ìƒê°ë‚¬ëŠ”ì§€ ìì‹ ì˜ ë‚¨í¸ê³¼ ë”¸ì— ëŒ€í•œ ê³ í†µì´ ë– ì˜¤ë¥¸ ê²ƒì¸ì§€, ëˆ„êµ°ì§€ ëª¨ë¥¼ ì—¬ìì— ëŒ€í•œ ë¶„ë…¸ì¸ì§€ 
ëˆ„êµ¬ë„ ì•Œ ìˆ˜ ì—†ëŠ” í™”ë¥¼ ë‚´ê¸° ì‹œì‘í•œë‹¤.
í…Œì´ë¸”ì— ìˆë˜ ë¬¼ê³¼ ì£½ì„ ë˜ì ¸ë²„ë¦¬ë©° ì‚¬ëŒ ê°™ì§€ ì•ŠëŠ” í¬íš¨ë¥¼ í•˜ê³  ìš¸ê³  ì›ƒê³ ë¥¼ ìƒˆë²½ê¹Œì§€ ì´ì–´ê°„ë‹¤.
ìì‹  ìì²´ë„ ì§€ì¹œ ê²ƒì¸ì§€ ì ì  ë…¸ê³¤í•´ì§€ê¸° ì‹œì‘í–ˆë‹¤.
ê·¸ ì—¬ìê°€ ì¤€ ì•½ì„ ë‚´ê°€ ë¨¹ì–´ë„ ë˜ëŠ” ê±¸ê¹Œ ë¬´ìŠ¨ ì•½ì¼ê¹Œ ë¼ëŠ” ê¶ê¸ˆì¦ê³¼ ì§€ê¸ˆ ë‚˜ëŠ” ì•ˆì „í•˜ëƒëŠ” ìƒê°ì„ í•˜ë©° ê·¸ ì—¬ìê°€ ê³¼ì—° ë‚´ê°€ ì°¾ëŠ” ì‚¬ëŒì„ ì°¾ì„ ìˆ˜ ìˆì„ê¹Œ ë¼ëŠ” ì˜êµ¬ì‹¬ê³¼ ë¶ˆì•ˆê° ì—¬ëŸ¬ ê°€ì§€ ìƒê°ì„ í•˜ë©°
ì•½í†µ ì•ˆì— ë“¤ì–´ìˆëŠ” ì•½ì„ í•œ ì•Œ êº¼ë‚´ ì…ì— ë¨¸ê¸ˆê³ ëŠ” í™”ì¥ì‹¤ì— ê°€ì„œ ì„¸ë©´ëŒ€ ë¬¼ë¡œ ëª©êµ¬ë©ìœ¼ë¡œ ë„˜ê¸´ë‹¤.
ê·¸ëŒ€ë¡œ ê±°ìš¸ì„ ë°”ë¼ë³´ë©° í•œì°¸ì„ ë°”ë¼ë³¸ë‹¤.
ï¼‚í•˜...ï¼‚
ê¹Šì€ í•œìˆ¨ì„ ë‚´ì‰¬ë©° ì¹¨ëŒ€ë¡œ ëŒì•„ê°€ ì ì„ ì²­í•œë‹¤.`;

async function uploadTUSAndCreate() {
    console.log("ğŸš€ Starting Drama Ep.1 Resumable Upload (TUS)...");

    if (!fs.existsSync(VIDEO_PATH)) {
        console.error(`âŒ Video file not found at ${VIDEO_PATH}.`);
        return;
    }

    const file = fs.createReadStream(VIDEO_PATH);
    const size = fs.statSync(VIDEO_PATH).size;

    console.log(`ğŸ“¤ Uploading ${(size / 1024 / 1024).toFixed(2)} MB to bucket '${BUCKET_NAME}'...`);

    // Use standard upload but let Supabase client handle it if possible, 
    // BUT since we saw error, we might need to manually TUS or just increase timeout if it was timeout.
    // However, error said "exceeded maximum allowed size". This means we MUST use TUS.

    // Supabase JS client `upload` method DOES support TUS under the hood if we use `resumable: true`? 
    // Actually in recent versions it does not by default, we need `supabase.storage.from(...).uploadToSignedUrl` or similar?
    // Let's try the dedicated TUS upload to the Supabase endpoint.

    // Endpoint: [ProjectURL]/storage/v1/upload/resumable
    const uploadUrl = `${process.env.NEXT_PUBLIC_SUPABASE_URL}/storage/v1/upload/resumable`;

    return new Promise((resolve, reject) => {
        const upload = new Upload(file, {
            endpoint: uploadUrl,
            retryDelays: [0, 3000, 5000, 10000, 20000],
            headers: {
                authorization: `Bearer ${process.env.SUPABASE_SERVICE_ROLE_KEY}`,
                'x-upsert': 'true', // Optional
            },
            uploadDataDuringCreation: true,
            chunkSize: 6 * 1024 * 1024, // 6MB chunks
            metadata: {
                bucketName: BUCKET_NAME,
                objectName: FILE_NAME,
                contentType: 'video/mp4',
            },
            onError: function (error) {
                console.log('failed', error);
                reject(error);
            },
            onProgress: function (bytesUploaded, bytesTotal) {
                const percentage = ((bytesUploaded / bytesTotal) * 100).toFixed(2);
                console.log(percentage + '%');
            },
            onSuccess: function () {
                console.log('Download %s from %s', upload.file.name, upload.url);
                resolve();
            },
        });

        upload.start();
    }).then(async () => {
        // After upload, creates DB record
        console.log("âœ… TUS Upload Complete. Creating DB record...");
        const { data: { publicUrl } } = supabase.storage.from(BUCKET_NAME).getPublicUrl(FILE_NAME);

        let userId = '34e0d951-d852-40e8-a751-18bb14430c83';
        const { data: userProfile } = await supabase.from('profiles').select('id').eq('username', 'Loca').single();
        if (userProfile) userId = userProfile.id;

        const ideaPayload = {
            title: "ë“œë¼ë§ˆ 1í™”: ì¸ì‚¬ (íšŒìƒ‰ ë„ì‹œì˜ í˜•ì²´)",
            description: FULL_SCRIPT_TEXT,
            type: 'video',
            price: 0,
            author_id: userId,
            private_content: publicUrl,
            metrics: {
                views: 0,
                likes: 0,
                metadata: {
                    genre: 'Drama',
                    ai_tool: 'Topaz Video AI',
                    status: 'approved',
                    video_url: publicUrl,
                    thumbnail_url: 'https://layerfilm.com/placeholder-film.jpg',
                    preview_url: publicUrl,
                    title_ko: "ë“œë¼ë§ˆ 1í™”: ì¸ì‚¬",
                }
            }
        };

        const { data: idea, error: dbError } = await supabase.from('ideas').insert(ideaPayload).select().single();
        if (dbError) console.error("âŒ DB Fail:", dbError.message);
        else console.log(`ğŸ‰ Success! ID: ${idea.id}`);
    });
}

uploadTUSAndCreate();
